#!/usr/bin/env bash

set -euo pipefail

ARCH=$(dpkg --print-architecture)

DOCKER_IMAGE="$1"
MNT="$2"

CONTAINER="$(docker create --platform "linux/${ARCH}" "$DOCKER_IMAGE")"
trap 'docker rm "$CONTAINER" > /dev/null' EXIT

includes=(bin etc lib sbin usr var/lib)
if [[ "$ARCH" == "amd64" ]]; then
	includes+=(lib64)
fi

docker export "$CONTAINER" | tar -x -C "$MNT" --exclude=lib/modules "${includes[@]}"
